#!/bin/bash

BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3

echo "Zlib-1.2.9 o'rnatilishi boshlandi..."

# .profile.d papkasining mavjudligini ta'minlang
mkdir -p $BUILD_DIR/.profile.d

# Tarballni chiqarish uchun to'g'ri yo'l
TAR_FILE=./zlib-1.2.9

# Tarballni chiqarish
if [ -d "$TAR_FILE" ]; then
  cp -r $TAR_FILE $BUILD_DIR
  echo "$TAR_FILE fayli mavjut"
  ls
  ls -l $BUILD_DIR
else
  ls
  ls -l $BUILD_DIR
  echo "Xatolik: zlib-1.2.9 fayli topilmadi: $TAR_FILE"
  exit 1
fi

# Zlib manziliga o'tish
cd $BUILD_DIR/zlib-1.2.9 || { echo "Zlib manzilga o'tishda xatolik"; exit 1; }

# Konfiguratsiya, qurish va o'rnatish
./configure --prefix=$BUILD_DIR/zlib
make
make install

# Zaruriy atrof muhit o'zgaruvchilarini eksport qilish
echo "export LD_LIBRARY_PATH=$BUILD_DIR/zlib/lib:\$LD_LIBRARY_PATH" >> $BUILD_DIR/.profile.d/zlib.sh
echo "export PATH=$BUILD_DIR/zlib/bin:\$PATH" >> $BUILD_DIR/.profile.d/zlib.sh

echo "Zlib-1.2.9 o'rnatilishi tugadi."
